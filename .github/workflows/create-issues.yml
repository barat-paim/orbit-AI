name: Create GitHub Issues

on:
  push:
    paths:
      - tickets.json

jobs:
  create_issues:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.x'

    - name: Install dependencies
      run: pip install requests

    - name: Create GitHub Issues
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        import json
        import requests
        
        with open('tickets.json', 'r') as f:
            tickets = json.load(f)
        
        headers = {
            'Authorization': f'Bearer {GITHUB_TOKEN}',
            'Accept': 'application/vnd.github.v3+json'
        }
        
        for ticket in tickets:
            response = requests.post(
                f'https://api.github.com/repos/${{{{ github.repository }}}}/issues',
                headers=headers,
                json={
                    'title': ticket['title'],
                    'body': ticket['body']
                }
            )
            if response.status_code == 201:
                print(f"Issue \"{ticket['title']}\" created successfully.")
            else:
                print(f"Failed to create issue \"{ticket['title']}\":", response.json())